<div class="row">
    <!-- PAGE HEADER -->
    <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <h1 class="page-title txt-color-blueDark">
            <i class="fa-fw fa fa-video-camera"></i>            
            <h id="pagetitle"></h>     
            </h1>
    </div>
</div>
<!-- end col -->
</div>
<!-- END OF HEADER -->
<div class="row" id="main-row">
    <!-- VIDEO PRINCIPAL -->
    <div class="col-xs-12 col-sm-9 col-md-9 col-lg-9" id="mainVideoColumn">
        <div class="alert alert-block alert-success">
            <button class="close">×</button>
            <h4 class="alert-heading"><i class="fa fa-check-square-o"></i> Bienvenido!</h4>
            <p>Aquí se puede mostrar la descripcion del curso y citar material a leer previo a la realización del curso.</p>
        </div>
        <div id="containingBlockRemote">
            <div class="videoWrapper">
                <object>
                    <video id="localVideo" controls></video>
                </object>
            </div>
        </div>
    </div>
    <!-- FIN VIDEO PRINCIPAL -->
    <!-- CHAT -->
    <div class="col-lg-3 col-md-3  hidden-xs hidden-sm" id="chatColumn">
        <!-- <div class="container"> -->
        <div class="panel panel-primary">
            <div class="panel-heading">
                <span class="glyphicon glyphicon-comment"></span> Chat
                <div class="btn-group pull-right">
                    <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                        <span class="glyphicon glyphicon-chevron-down"></span>
                    </button>
                    <ul class="dropdown-menu slidedown">
                        <li><a href="#"><span class="glyphicon glyphicon-refresh">
                            </span>Refresh</a></li>
                        <li><a href="#"><span class="glyphicon glyphicon-ok-sign">
                            </span>Available</a></li>
                        <li><a href="#"><span class="glyphicon glyphicon-remove">
                            </span>Busy</a></li>
                        <li><a href="#"><span class="glyphicon glyphicon-time"></span>
                                Away</a></li>
                    </ul>
                </div>
            </div>
            <div class="panel-body">
                <ul class="chat">
                    <li class="left clearfix"><span class="chat-img pull-left">
                           
                        </span>
                        <div class="chat-body clearfix">
                            <div class="header">
                                <strong class="primary-font">Horacio Gonzales</strong> <small class="pull-right text-muted">
                                        <span class="glyphicon glyphicon-time"></span>Hace 12 mins</small>
                            </div>
                            <p>
                                Hola, soy Horacio Gonzales y soy gerente de ventas. Si tienen alguna pregunta no duden en consultarme.
                            </p>
                        </div>
                    </li>
                    <li class="right clearfix"><span class="chat-img pull-right">

                           
                        </span>
                        <div class="chat-body clearfix">
                            <div class="header">
                                <small class=" text-muted"><span class="glyphicon glyphicon-time"></span>Hace 13 mins</small>
                                <strong class="pull-right primary-font">Martín Pérez</strong>
                            </div>
                            <p>
                                Hola Horacio, tengo dudas respecto al tema dos.
                            </p>
                        </div>
                    </li>
                    <li class="left clearfix"><span class="chat-img pull-left">
                            
                        </span>
                        <div class="chat-body clearfix">
                            <div class="header">
                                <strong class="primary-font">Horacio Gonzales</strong> <small class="pull-right text-muted">
                                        <span class="glyphicon glyphicon-time"></span>Hace 14 mins</small>
                            </div>
                            <p>
                                Dime Martín. ¿Qué necesitas saber?
                            </p>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="panel-footer">
                <div class="input-group">
                    <input id="btn-input" type="text" class="form-control input-sm" placeholder="Escribe tu mensaje aquí..." />
                    <span class="input-group-btn">
                            <button class="btn btn-info btn-sm" id="btn-chat">
                                Enviar</button>
                        </span>
                </div>
            </div>
        </div>
        <!-- </div> -->
    </div>
    <!-- FIN CHAT -->
</div>
</div>
<!--ESTILO DEL CHAT-->
<style>
#chatColumn {
    /*position: absolute;
    right: 0;
    height: 100%;
    top: 2px;*/
}

.chat {
    list-style: none;
    margin: 0;
    padding: 0;
    *
}

.chat li {
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px dotted #B3A9A9;
}

.chat li.left .chat-body {
    margin-left: 15px;
}

.chat li.right .chat-body {
    margin-right: 15px;
}

.chat li .chat-body p {
    margin: 0;
    color: #777777;
}

.panel {
    /*position: absolute;
    right: 0;
    top: 0;
    width: 255px;*/
}

.panel .slidedown .glyphicon,
.chat .glyphicon {
    margin-right: 5px;
}

.panel-body {
    overflow-y: scroll;
    height: 73vh;
    padding: 0;
}

::-webkit-scrollbar-track {
    -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
    background-color: #F5F5F5;
}

::-webkit-scrollbar {
    width: 12px;
    background-color: #F5F5F5;
}

::-webkit-scrollbar-thumb {
    -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, .3);
    background-color: #555;
}

.panel-primary>.panel-heading {
    color: #fff;
    background-color: #474544;
    border-color: #474544;
}

.chat-body {
    overflow-y: hidden;
    height: auto;
}
</style>
<!--ESTILO DE LOS VIDEOS-->
<style>
#mainVideoColumn {
    height: 70vh;
    /*width: 70%;*/
    /* left: 2vh;*/
}

.videoWrapper {
    position: relative;
    padding-bottom: 56.25%;
    /* 16:9 */
    padding-top: 25px;
}

.videoWrapper object,
.videoWrapper div {
    position: absolute;
    /*width: 100%;*/
    height: 100%;
    right: 0;
}

.videoWrapper object,
.videoWrapper video {
    position: absolute;
    width: 100%;
    height: 100%;
    background-color: black;
}
</style>
</style>
<script src="/js/rtc/simplewebrtc.bundle.js"></script>
<!-- end row -->
<script type="text/javascript">
/* DO NOT REMOVE : GLOBAL FUNCTIONS!
 *
 * pageSetUp(); WILL CALL THE FOLLOWING FUNCTIONS
 *
 * // activate tooltips
 * $("[rel=tooltip]").tooltip();
 *
 * // activate popovers
 * $("[rel=popover]").popover();
 *
 * // activate popovers with hover states
 * $("[rel=popover-hover]").popover({ trigger: "hover" });
 *
 * // activate inline charts
 * runAllCharts();
 *
 * // setup widgets
 * setup_widgets_desktop();
 *
 * // run form elements
 * runAllForms();
 *
 ********************************
 *
 * pageSetUp() is needed whenever you load a page.
 * It initializes and checks for all basic elements of the page
 * and makes rendering easier.
 *
 */

pageSetUp();

/*
 * ALL PAGE RELATED SCRIPTS CAN GO BELOW HERE
 * eg alert("my home function");
 * 
 * var pagefunction = function() {
 *   ...
 * }
 * loadScript("js/plugin/_PLUGIN_NAME_.js", pagefunction);
 * 
 * TO LOAD A SCRIPT:
 * var pagefunction = function (){ 
 *  loadScript(".../plugin.js", run_after_loaded);  
 * }
 * 
 * OR
 * 
 * loadScript(".../plugin.js", run_after_loaded);
 */

// PAGE RELATED SCRIPTS

// pagefunction

var pagefunction = function() {

    $('.superbox').SuperBox();

    $('#pagetitle').html(window.roomname);

    $(".page-footer").hide();

    //Pasando el parámetro localVideoEl levanta automáticamente tu video en contenedor que se llame con el nombre asignado al parámetro

    webrtc = new SimpleWebRTC({
        // the id/element dom element that will hold "our" video
        localVideoEl: 'localVideo',
        // the id/element dom element that will hold remote videos
        remoteVideosEl: '',
        // immediately ask for camera access
        autoRequestMedia: true,

        mirror: false
    });

    // we have to wait until it's ready
    webrtc.on('readyToCall', function() {
        // you can name it anything
        webrtc.joinRoom(window.room);
    });


    //Cuando se desconecta un peer
    webrtc.on('videoRemoved', function(video, peer) {

        $(document).ready(function() {
            $("#remoteVideoColumn").hide();
        });


        console.log('video removed ', peer);
        var remotes = document.getElementById('remotes');
        var el = document.getElementById(peer ? 'container_' + webrtc.getDomId(peer) : 'localScreenContainer');
        if (remotes && el) {
            remotes.removeChild(el);
        }

        var vid = document.getElementById("localVideo");


        // var fullscreenbtn = document.getElementById("fullscreenbtn");
        // var playbtn = document.getElementById("playpausebtn");
        // var mutebtn = document.getElementById("mutebtn");
        // var volumeslider = document.getElementById("volumeslider");

        // playbtn.addEventListener("click", playPause, false);
        // mutebtn.addEventListener("click", vidmute, false);
        // volumeslider.addEventListener("change", setvolume, false);
        vid.addEventListener("dblclick", toggleFullScreen, false);

        function toggleFullScreen() {
            if (vid.requestFullScreen) {
                vid.requestFullScreen();
            } else if (vid.webkitRequestFullScreen) {
                vid.webkitRequestFullScreen();
            } else if (vid.mozRequestFullScreen) {
                vid.mozRequestFullScreen();
            }
        }

        function playPause() {
            if (vid.paused) {
                vid.play();
                playbtn.innerHTML = "Pause";
            } else {
                vid.pause();
                playbtn.innerHTML = "Play";
            }
        }

        function vidmute() {
            if (vid.muted) {
                vid.muted = false;
                mutebtn.innerHTML = "Mute";
            } else {
                vid.muted = true;
                mutebtn.innerHTML = "Unmute";
            }
        }

        function setvolume() {
            vid.volume = volumeslider.value / 100;
        }
    });

};
var pagedestroy = function() {
    webrtc.stopLocalVideo();
    webrtc.leaveRoom();
    $(".page-footer").show();

};


// end pagefunction

// run pagefunction on load

// load bootstrap-progress bar script
loadScript("js/plugin/superbox/superbox.min.js", pagefunction);
</script>
